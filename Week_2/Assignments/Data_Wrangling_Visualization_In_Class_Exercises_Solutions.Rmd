---
title: "Data_Wrangling_Visualization_In_Class_Exercise_Solutions"
output: pdf_document
date: "2025-06-20"
---

1) Download the file In_Class_Exercises_Arsenic.csv file associated with this week's in class assignment. This data is adapted from the 2015-2016 National Health and Nutrition Examination Survey (NHANES). I've truncated the data to include only a few demographic variables along with urinary arsenic levels. Using base R, generate a quick box plot displaying the total arsenic levels by gender. Make sure that you provide appropriate labels to the x- and y- axes as well as the main title. Add some color to your plot too! 

Save this file as a .png. Play around with widths and heights of the plots to get them just right. 
```{r setup, include=TRUE}
dat <- read.csv("/Users/f002yt8/Documents/GitHub/HDS-Foundations_of_Data_Science/Week_2/Data/Assignment_2_Arsenic.csv")

png("/Users/f002yt8/Documents/GitHub/HDS-Foundations_of_Data_Science/Week_2/Data/arsenic_boxplot.png", width = 1500, height = 1500, res = 300)
boxplot(Arsenic_Total ~ Gender, data = dat, main = "Arsenic Total by Gender", col = c("#E9D7C0","#BAD6D1"), xlab = "Gender", ylab = "Arsenic Total (ug/L)")
dev.off()
```

2) Using `ggplot2()`, generate another box plot using the data frame of NHANES data from the previous question, but this time make it a box plot grouped by gender on the y-axis. Break up each of the groups by marital status. Add a jitter to each of the box plots. 

```{r}
library(ggplot2)

p <- ggplot(dat, aes(x = Gender, y = Arsenic_Total, fill = Marital_Status)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.7, position = position_dodge(width = 0.75)) +
  geom_jitter(aes(color = Marital_Status), position = position_dodge(width = 0.75), size = 2, alpha = 0.6) + labs(x = "Gender", y = "Arsenic_Total", fill = "Marital Status", color = "Marital Status",
       title = "Arsenic Total Distribution \nby Gender and Marital Status") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1") +
  scale_color_brewer(palette = "Set1")


```

3) Generate a violin plot of the total arsenic levels by marital status. Conduct a Wilcoxon Rank Sum test and report the p-value between the Married and Never Married participants on the violin plots. 

```{r}
library(ggpubr)

comparison_data <- dat[dat$Marital_Status %in% c("Married", "Never Married"), ]
p <- ggplot(dat, aes(x = Marital_Status, y = Arsenic_Total, fill = Marital_Status)) +
  geom_violin() +
  labs(x = "Marital Status", y = "Arsenic Total (ug/L)", fill = "Marital Status",
       title = "Arsenic Total (ug/L) by Marital Status") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1") +
  stat_compare_means(comparisons = list(c("Married", "Never Married")),
                     method = "wilcox",
                     label = "p.format")
print(p+ theme(axis.text.x = element_text(angle = 45, hjust = 1)))
```

4) Generate your own random data of 200 participants containing the following columns: Participant_ID, Age, Sex, BMI, Ferritin_Level, and Disease_Status. Make it so that the "Cases" have generally lower ferritin levels. Normal ferritin levels are ~20–500 ng/mL in males and ~20–200 ng/mL in women. Make sure that BMIs are reasonable too! BMI is usually a normally distributed statistic centered around 25 (normal range: ~18.5–30+). Age should be just adults 18-99. Having done that, provide summary statistics for the ferritin levels. 

```{r}
## Number of participants
n <- 200

## Generate Participant IDs
Participant_ID <- paste("Participant", 1:n, sep = "_")

## Generate Age
Age <- sample(18:99, n, replace = TRUE)

## Generate Sex: Male or Female
Sex <- sample(c("Male", "Female"), n, replace = TRUE)

## Generate Disease Status: 50% Case, 50% Control
Disease_Status <- sample(c("Case", "Control"), n, replace = TRUE)

## Generate BMI
BMI <- round(rnorm(n, mean = 25, sd = 4), 1)
BMI[BMI < 15] <- 15
BMI[BMI > 45] <- 45

## Generate Ferritin Levels
Ferritin_Level <- numeric(n)

for (i in 1:n) {
  if (Disease_Status[i] == "Case") {
    Ferritin_Level[i] <- ifelse(Sex[i] == "Male",
                                rnorm(1, mean = 60, sd = 20),
                                rnorm(1, mean = 40, sd = 15))
  } else {
    Ferritin_Level[i] <- ifelse(Sex[i] == "Male",
                                rnorm(1, mean = 180, sd = 70),
                                rnorm(1, mean = 100, sd = 50))
  }
}

## Clamp to non-negative and realistic maximums
Ferritin_Level <- pmin(pmax(Ferritin_Level, 5), 600)
Ferritin_Level <- round(Ferritin_Level, 1)

## Combine into a data frame
df <- data.frame(
  Participant_ID,
  Age,
  Sex,
  BMI,
  Ferritin_Level,
  Disease_Status
)

## Visualize
head(df)

## Summary Statistics
summary(df$Ferritin_Level)
```

5) Convert the data frame to long format from wide format on the Age and Ferratin_Level columns. Remove the Sex column from this data frame. 
```{r}

df_long <- tidyr::pivot_longer(df,cols = c("Age", "Ferritin_Level"))

head(df_long)
```



