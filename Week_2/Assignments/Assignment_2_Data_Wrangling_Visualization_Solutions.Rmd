---
title: "Assignment_2_Data_Wrangling_Visualization_Solutions"
output: pdf_document
date: "2025-06-23"
---

1) Generating random data is a useful skill. An exercise such as this is not only useful for developing data wrangling skills, but we can also use the resulting data for training and testing sets in machine learning. For this first exercise, I would like you to generate a data frame of random data with the following attributes:

a) The data frame should contain the following columns: 
- Participant_ID: Generate reasonable participant IDs such as "Participant_001", or something similar. 
- Sex: Male and Female
- Age: Should follow a normal distribution and be bound between the ages 18 and 90.
- Activity_Status: Should contain the levels "Inactive", "Lightly Active", "Average Activity", and "Very Active".
- Disease_Status: Should contain "Case" and "Control" levels. Participants with a systolic blood pressure greater than or equal to 150 and a diastolic blood pressure greater than or equal to 95 should be considered a "Case", otherwise the participant should be considered a "Control". 
- Systolic_Blood_Pressure: The distribution from which the systolic blood pressure values should be taken is a normal distribution with a minimum of 110 and a maximum of 200. The mean should be 120 and the standard deviation should be 30. 
- Diastolic_Blood_Pressure: The diastolic blood pressures should be dependent on the systolic blood pressures if a systolic blood pressure is less than or equal to 120 than the diastolic blood pressure should follow a normal distribution where the minimum is 70 and the maximum is 100 with a mean of 80 and a standard deviation of 5. Otherwise, the diastolic blood pressure should have a minimum of 90 and a maximum of 150. This should also follow a normal distribution. The mean should be 100 abd the standard deviation should be 5.

b) The data set should contain 100 participants

```{r}
# Set up number of participants 
n=100

# Create a vector of systolic blood pressures
Systolic_Blood_Pressure <- pmax(110, pmin(200, round(rnorm(n, mean = 120, sd = 30))))
head(Systolic_Blood_Pressure)

# Create a vector of diastolic blood pressures that corresponds to systolic blood pressures
Diastolic_Blood_Pressure <- c()
for (bp in Systolic_Blood_Pressure){
  if (bp <= 120){
    d_bp <- pmax(70, pmin(100, round(rnorm(1, mean = 80, sd = 5))))
    Diastolic_Blood_Pressure <- c(Diastolic_Blood_Pressure, d_bp)
  } else{
    d_bp <- pmax(90, pmin(150, round(rnorm(1, mean = 100, sd = 5))))
    Diastolic_Blood_Pressure <- c(Diastolic_Blood_Pressure, d_bp)
  }
}

# Create data frame
dat <-  data.frame(Participant_ID = paste("P", 1:n, sep = "_"),
                   Age = pmax(18, pmin(90, round(rnorm(n, mean = 50, sd = 10)))),
                   Sex = sample(c("Male", "Female"), n, replace = TRUE),
                   Activity_Status = sample(c("Inactive","Lightly Active","Average Activity", "Very Active")),
                   Disease_Status = sample(c("Case", "Control"), n, replace = TRUE),
                   Systolic_Blood_Pressure,
                   Diastolic_Blood_Pressure
                   )

# Create a Disease_Status  vector where the participants with higher blood pressures are cases
Disease_Status <- c()
for (i in 1:nrow(dat)){
  if ((dat[i,"Systolic_Blood_Pressure"] >= 150) & (dat[i,"Diastolic_Blood_Pressure"] >= 95)) {
    Disease_Status <- c(Disease_Status, "Case")
    } else {
      Disease_Status <- c(Disease_Status, "Control ")
    }
  }

# Add Disease Status to dataframe
dat$Disease_Status <- Disease_Status

# Visualize after adding the Disease Status column
head(dat)
```
2) Convert the data frame you generated above from wide to long format based on the systolic and diastolic blood pressure columns. Make sure you take a look at the column names and how the data frame is now formatted after converting to long form!
```{r}
library(tidyr)
dat_long <- pivot_longer(dat, cols = c("Systolic_Blood_Pressure","Diastolic_Blood_Pressure"), names_to = "Blood_Pressures")
print(head(dat_long))
```

3) As Data Scientists we will be asked to generate some neat looking figures. In the following questions, generate ggplot figures using the long format data you generated in the previous question, unless otherwise specified. 
a) Generate a grouped ggplot2 box plot of the systolic and diastolic blood pressures in cases and controls. The x-axis should be the blood pressure types. The y-axis should be the blood pressure values. The fill should be the disease status: case or control. 

```{r}
library(ggplot2)
p <- ggplot(dat_long, aes(x = Blood_Pressures, y = value, fill =Disease_Status)) +
  geom_boxplot(width = 0.5)+
  labs(x = "Blood Pressure Type", y = "Blood Pressure", fill = "Disease Status", 
       title = "Systolic and Diastolic Blood \nPressure by Disease Status")+
  theme_minimal() +
  scale_fill_brewer(palette = "Set1")+ scale_x_discrete(labels = c("Diastolic_Blood_Pressure" = "Diastolic Blood Pressure", "Systolic_Blood_Pressure" = "Systolic Blood Pressure"))
```

b) Generate a ggplot2 histogram of the systolic and diastolic blood pressures. Color the bars by disease status: case and control.
```{r}
ggplot(dat_long, aes(x = value, fill = Disease_Status)) +
geom_histogram(position = "identity", alpha = 0.5, bins = 100)+
  labs(x = "Blood Pressure", y = "Counts", fill = "Disease Status", 
       title = "Systolic and Diastolic Blood \nPressure by Disease Status") +
  scale_fill_brewer(palette = "Set2")
```

c) Using the wide format data frame, generate a scatter plot of systolic blood pressure on the x-axis and diastolic blood pressure on the y-axis. Once again, color the points by disease status: case and control. 
```{r}
ggplot(dat, aes(x = Systolic_Blood_Pressure, y = Diastolic_Blood_Pressure, fill =Disease_Status)) +
  geom_point(size=2, shape=23)
```

4) Building off the code you used to generate the box plot above, add code that runs a wilcoxon rank sum test and display the resulting p-values comparing the cases and controls in the diastolic and systolic blood pressures on your box plot. Save your figure as a .png file and upload it with the submission for this assignment. After completing this, report the summary statistics for the systolic and diastolic blood pressures separately. 

```{r}
library(ggpubr)
png("/Users/f002yt8/Documents/GDSC/GitHub/HDS-Foundations_of_Data_Science/Week_2/images/boxplot.png", width = 2000, height = 1500, res = 300)
p + stat_compare_means(method = "wilcox")
dev.off()

summary(dat$Systolic_Blood_Pressure)
summary(dat$Diastolic_Blood_Pressure)
```

5) Remove the systolic and diastolic blood pressure columns in the wide format data frame. Generate a heart rate column instead and add that to the data frame. The heart rates should be dependent on the level of activity of the participant. Participants who are "Inactive" should have a heart rate taken from a normal distribution with a minimum of 100 and a maximum of 200. The mean of this distribution should be 150 and have a standard deviation of 20. If the participant is "Lightly Active", their heart rate should be taken from a normal distribution with a minimum of 80 and a maximum of 99. The mean of this distribution should be 85 and the standard deviation should be 20. Finally, if the paticipant is "Average Activity" or "Very Active", their heart rate shoul dbe taken from a normal distribution with a minimum of 40 and a maximum of 70. The mean of this distribution should be 50 and the standard deviation 20. 

```{r}
dat <- subset(dat, select = -c(Diastolic_Blood_Pressure, Systolic_Blood_Pressure))
n=100

Heart_Rate <- c()
for (i in 1:nrow(dat)){
  if (dat[i,"Activity_Status"] == "Inactive"){
    Heart_Rate <- c(Heart_Rate,pmax(100,pmin(200, round(rnorm(1, mean = 150, sd = 20)))))
    } else if (dat[i,"Activity_Status"] == "Lightly Active"){
      Heart_Rate <- c(Heart_Rate,pmax(80,pmin(99, round(rnorm(1, mean = 85, sd = 20)))))
      } else {
        Heart_Rate <- c(Heart_Rate,pmax(40,pmin(79, round(rnorm(1, mean = 50, sd = 20)))))
      }
}

dat$Heart_Rate <- Heart_Rate
print(head(dat))
```

